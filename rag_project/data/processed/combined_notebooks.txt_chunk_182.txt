to be sent def query_or_respondstate MessagesState Generate tool call for retrieval or respond llm_with_tools  llmbind_toolsretrieve response  llm_with_toolsinvokestatemessages  MessagesState appends messages to state instead of overwriting return messages response  Step 2 Execute the retrieval tools  ToolNoderetrieve  Step 3 Generate a response using the retrieved content def generatestate MessagesState Generate answer  Get generated ToolMessages recent_tool_messages   for message in reversedstatemessages 